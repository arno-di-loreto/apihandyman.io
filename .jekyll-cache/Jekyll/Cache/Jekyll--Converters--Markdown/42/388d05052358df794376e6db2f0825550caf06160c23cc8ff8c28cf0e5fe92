I"•«<p>Ever wanted to quickly find, extract or modify data coming from some JSON documents on the command line? JQ is the tool you‚Äôre looking for. Thanks to the two previous parts of this JQ and OpenAPI Series, we learned how to extract data from JSON (OpenAPI) files by discovering many filters, creating modules and using command line arguments. Now we will discover how to modify them; how to replace, add or delete elements in processed documents. <!--more--></p>

<div class="card series-toc">
  <div class="card-header series-toc-title">
    <h5 id="series">JQ and OpenAPI Series</h5>
  </div>
  <div class="row series-toc_content">
    <div class="col-md-7 series-toc-summary">
      <div class="card-body">
        <p class="card-text">
JQ's <a href="https://stedolan.github.io/jq/manual/v1.6/" target="jq">documentation</a> is quite complete and there are many tutorials and Stackoverflow answers, so why bother writing this series? First reason, I regularly meet people working with APIs and/or JSON files who actually don't know JQ exists and how it could save their life (or at least their time). Second reason, I often use it with OpenAPI specification files and I found that showing how JQ can be used on such a widely adopted and familiar JSON based format could help to learn how to use it (and also writing this post actually helped me to improve my JQ skills!).
</p>
      </div>
    </div>
    <div class="col-md-5 series-toc-list">
      
      <ul class="list-group list-group-flush">
        
          
          <li class="list-group-item"><a href="/api-toolbox-jq-and-openapi-part-1-using-jq-to-extract-data-from-openapi-files/">1 - Using JQ to extract data from OpenAPI files</a></li>
          
        
          
          <li class="list-group-item"><a href="/api-toolbox-jq-and-openapi-part-2-using-jq-command-line-arguments-functions-and-modules/">2 - Using JQ command line arguments, functions and modules</a></li>
          
        
          
          <li class="list-group-item active">3 - Modifying OpenAPI files with JQ</li>
          
        
          
          <li class="list-group-item"><a href="/api-toolbox-jq-and-openapi-part-4-bonus-coloring-jqs-raw-output/">4 - Bonus: Coloring JQ's raw output</a></li>
          
        
        
          
          
          
        
          
          
          
        
      </ul>
    </div>
  </div>
</div>

<h1 id="get-posts-content">Get post‚Äôs content</h1>

<p>All examples shown in this post are based on JQ 1.6 and OpenAPI 3. All examples can be copied using the <span class="icon-inline icon-text" aria-label="copy button icon"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M14,2V0H6v2H2v18h16V2H14z M12,2v2H8V2H12z M16,18H4V4h2v2h8V4h2V18z"></path></svg></span> button and downloaded using the <span class="icon-inline icon-text" aria-label="download button icon"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><g><polygon points="15,11 13.6,9.6 11,12.2 11,0 9,0 9,12.2 6.4,9.6 5,11 10,16  "></polygon><polygon points="18,12 18,18 2,18 2,12 0,12 0,20 20,20 20,12  "></polygon></g></svg></span> one on code snippets. All source code can be retrieved from the <a href="https://github.com/arno-di-loreto/jq-and-openapi/" target="jq">JQ and OpenAPI post series‚Äô github repository</a>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">git clone https://github.com/arno-di-loreto/jq-and-openapi/
cd jq-and-openapi
git checkout part-3

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title"></p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ git clone https://github.com/arno-di-loreto/jq-and-openapi/
[apihandyman.io]$ cd jq-and-openapi
[apihandyman.io]$ git checkout part-3</code></pre>
  </div>
</div>

<p>We will go on using the <code>demo-api-openapi.json</code> OpenAPI file in this post:</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">demo-api-openapi.json</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/demo-api-openapi.json" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-json line-numbers code-copy"><code class="code-block">{"openapi":"3.0.0","info":{"title":"Banking API","version":"1.0.0-snapshot","description":"The Banking API provides access to the [Banking Company](http://www.bankingcompany.com) services, which include bank account information, beneficiaries, and money transfer management.&#60;!--more--&#62;\n\n# Authentication\n\n## How to \n- Register\n- Create an APP\n- Request credentials\n\n# Use cases\n\n## Transferring money to an account or preexisting beneficiary\n\nThe _transfer money_ operation allows one to transfer an `amount` of money from a `source` account to a `destination` account or beneficiary.\nIn order to use an appropriate `source` and `destination`, we recommend to use _list sources_ and _list source's destinations_ as shown in the figure below (instead of using _list accounts_ and _list beneficiaries_).\n\n![Diagram](http://localhost:9090/12.2-operation-manual-diagram.svg)\n\n## Cancelling a delayed or recurring money transfer\n\n- List money transfers: To list existing money transfers and select the one to delete\n- Cancel a money transfer: To cancel the selected money transfer\n","contact":{"name":"The Banking API team","email":"api@bankingcompany.com","url":"developer.bankingcompany.com"}},"tags":[{"name":"Transfers","description":"Everything you need to manage money transfers. A money transfer consists in transferring money from a source account to a destination account."},{"name":"Beneficiaries","description":"Everything you need to manage money transfer beneficiaries. Beneficiaries are pre-registred external accounts that can be used as destinations for money transfers."}],"paths":{"/accounts":{"get":{"tags":["Accounts"],"summary":"List accounts","responses":{"200":{"description":"User's accounts","content":{"application/json":{"schema":{"required":["properties"],"properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/Account"}}}}}}}}}},"/accounts/{id}":{"get":{"tags":["Accounts"],"summary":"Get an account","parameters":[{"name":"id","in":"path","description":"Account's id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"The account","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Account"}}}},"401":{"description":"Unauthorized"}},"x-implementation":{"security":{"description":"Only accounts belonging to user referenced in security data;\nreturn a 404 if this is not the case\n","source":{"system":"security","location":"jwt.sub"},"fail":404}}}},"/beneficiaries":{"post":{"tags":["Beneficiaries"],"summary":"Register a beneficiary","security":[{"BankingAPIScopes":["beneficiary:create","beneficiary:admin"]}],"responses":{"201":{"description":"Beneficiary added"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"}}},"get":{"tags":["Beneficiaries"],"summary":"List beneficiaries","security":[{"BankingAPIScopes":["beneficiary:read","beneficiary:admin"]}],"responses":{"200":{"description":"The beneficiaries list"}}}},"/beneficiaries/{id}":{"parameters":[{"name":"id","in":"path","description":"Beneficiary's id","required":true,"schema":{"type":"string"}}],"delete":{"deprecated":true,"tags":["Beneficiaries"],"summary":"Delete a beneficiary","security":[{"BankingAPIScopes":["beneficiary:delete","beneficiary:admin"]}],"responses":{"204":{"description":"Beneficiary deleted"},"401":{"description":"Unauthorized"}}},"patch":{"deprecated":true,"tags":["Beneficiaries"],"summary":"Updates a beneficiary","security":[{"BankingAPIScopes":["beneficiary:admin"]}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BeneficiaryUpdate"}}}},"responses":{"200":{"description":"The updated beneficiary"},"401":{"description":"Unauthorized"}}},"get":{"tags":["Beneficiaries"],"summary":"Get a beneficiary","security":[{"BankingAPIScopes":["beneficiary:read","beneficiary:admin"]}],"responses":{"200":{"description":"The beneficiary"}}}},"/sources":{"get":{"summary":"List transfer sources","tags":["Transfers"],"description":"Not all bank accounts can be used as a source\nfor a money transfers. This operation returns\nonly the accounts elligible as a money transfer\nsource.\n","responses":{"200":{"description":"The transfer sources"}}}},"/sources/{id}/destinations":{"parameters":[{"name":"id","in":"path","description":"Source's id","required":true,"schema":{"type":"string"}}],"get":{"summary":"List transfer source's destinations","tags":["Transfers"],"description":"Depending on the source account, only specific\nbeneficiaries or accounts can be used as a money\ntransfer destination.\nThis operation returns them.\n","responses":{"200":{"description":"The transfer destination"}}}},"/transfers":{"post":{"summary":"Transfer money","security":[{"BankingAPIScopes":["transfer:create","transfer:admin"]}],"tags":["Transfers"],"description":"This operation allows one to transfer an `amount` of money from a `source` account to a `destination` account.\nThere are three different types of money transfer:\n  - Immediate -- these are executed as soon as the request is received \n  - Delayed -- these are executed upon a given future `date`\n  - Recurring -- these are executed a given `occurrences` number of times at a given `frequency` -- the first occurrence being executed immediately or at a given `date`\n","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TransferRequest"},"examples":{"immediate":{"summary":"Immediate transfer","description":"The money transfer is executed immediately","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2}},"delayed":{"summary":"Delayed transfer","description":"The money transfer is executed at a given date","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2,"date":"2019-03-19"}},"recurring":{"summary":"Recurring transfer","description":"The money transfer is executed at a given date reurringly","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2,"date":"2019-03-19","occurrences":1,"frequency":"MONTHLY"}}}}}},"responses":{"201":{"description":"Immediate or recurring transfer executed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TransferResponse"},"examples":{"immediate":{"summary":"Immediate transfer","description":"The money transfer is executed immediately","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2}},"recurring":{"summary":"Recurring transfer","description":"The first occurence is executed immediately","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2,"date":"2019-03-19","occurrences":1,"frequency":"MONTHLY"}}}}}},"202":{"description":"Delayed or recurring delayed transfer accepted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TransferResponse"},"examples":{"delayed":{"summary":"Delayed transfer","description":"The money transfer is executed at a given date","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2,"date":"2019-03-19"}},"recurring":{"summary":"Recurring transfer","description":"The money transfer is executed at a given date reurringly","value":{"source":"000534115776675","destination":"000567689879878","amount":456.2,"date":"2019-03-19","occurrences":1,"frequency":"MONTHLY"}}}}}},"400":{"description":"The transfer is rejected due to an error in the request properties or an insufficient balance.\nEach error provides the property `source` of the error along with a human-readable `message` and its `type`:\n\n- MANDATORY_PROPERTY: The property indicated in `source` is missing\n- INVALID_FORMAT: The format of the property indicated in `source` is invalid\n- INVALID_VALUE: The value of the property indicated in `source` is invalid\n- INSUFFICIENT_BALANCE: The `amount` property is higher than the `source` account balance\n","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConsumerError"}}}}}},"get":{"summary":"List money transfers","tags":["Transfers"],"security":[{"BankingAPIScopes":["transfer:read","transfer:admin"]}],"responses":{"200":{"description":"Transfers list","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TransferList"}}}}}}},"/transfers/{id}":{"parameters":[{"name":"id","in":"path","description":"Transfer's id","required":true,"schema":{"type":"string"}}],"get":{"summary":"Get a money transfer","tags":["Transfers"],"security":[{"BankingAPIScopes":["transfer:read","transfer:admin"]}],"responses":{"200":{"description":"The money transfer"},"404":{"description":"The money transfer does not exist"}}},"x-tension-example":{"some":"value"},"patch":{"tags":["Transfers"],"responses":{"200":{"description":"The money transfer has been update"}}},"delete":{"summary":"Cancel a money transfer","tags":["Transfers"],"security":[{"BankingAPIScopes":["transfer:delete","transfer:admin"]}],"description":"Only delayed or recurring money transfer can be canceled","responses":{"204":{"description":"The money transfer has been deleted"},"404":{"description":"The money transfer does not exist"}}}}},"components":{"securitySchemes":{"BankingAPIScopes":{"type":"oauth2","flows":{"implicit":{"authorizationUrl":"https://auth.bankingcompany.com/authorize","scopes":{"transfer:create":"Create transfers","transfer:read":"Read transfers","transfer:delete":"Delete transfers","transfer:admin":"Create, read, and delete transfers","beneficiary:create":"Create beneficiaries","beneficiary:read":"List beneficiaries","beneficiary:delete":"delete beneficiaries","beneficiary:admin":"Create, read, and delete beneficiaries","account:read":"Read accounts","account:admin":"Read accounts"}}}}},"schemas":{"BeneficiaryUpdate":{"description":"A beneficiary update parameter","properties":{"name":{"type":"string"}}},"UselessSchema":{"description":"An unused useless schema","type":"string"},"TransferRequest":{"description":"A money transfer request","required":["source","destination","amount"],"properties":{"deprecatedPropertyExample":{"deprecated":true,"type":"string","description":"An example of a deprecated property"},"source":{"type":"string","description":"Source account number","minLength":15,"maxLength":15,"pattern":"^\\d{15}$","example":"000534115776675"},"destination":{"type":"string","description":"Destination account number","minLength":15,"maxLength":15,"pattern":"^\\d{15}$","example":"000567689879878"},"amount":{"type":"number","example":456.2,"minimum":0,"exclusiveMinimum":true},"date":{"type":"string","format":"date","description":"Execution date for a delayed transfer\nor first execution date for a recurring one\n","example":"2019-03-19"},"occurrences":{"type":"integer","description":"Number of times a recurring transfer will be executed\n","example":2,"minimum":2,"maximum":100},"frequency":{"type":"string","description":"Frequency of recurring transfer's execution","example":"MONTHLY","enum":["WEEKLY","MONTHLY","QUARTERLY","YEARLY"]}}},"TransferResponse":{"allOf":[{"required":["id","type","status"],"properties":{"id":{"type":"string","example":"1611e71f-1bb2-412f-8c43-92b275a5c321"},"type":{"type":"string","enum":["IMMEDIATE","DELAYED","RECURRING"],"example":"RECURRING"},"status":{"type":"string","description":"An immediate transfer is always `EXECUTED`, a delayed transfer can be `EXECUTED` or `PENDING` and a recurring one is always `PENDING`\n","enum":["EXECUTED","PENDING"],"example":"PENDING"},"requestDate":{"type":"string","example":"2019-09-19"}}},{"$ref":"#/components/schemas/TransferRequest"}]},"TransferList":{"properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/TransferResponse"}}}},"ConsumerError":{"required":["errors"],"properties":{"errors":{"description":"A list of errors providing detailed information about the problem","type":"array","minItems":1,"items":{"required":["source","type","message"],"properties":{"source":{"description":"the property source of the error","type":"string","example":"amount","enum":["source","destination","amount","date","occurrences","frequency"]},"type":{"type":"string","example":"MANDATORY_PROPERTY","enum":["MANDATORY_PROPERTY","INVALID_FORMAT","INVALID_VALUE","INSUFFICIENT_BALANCE"]},"message":{"description":"a human-readable error message","type":"string","example":"The money transfer's amount must be provided"}}}}}},"ProviderError":{"properties":{"errors":{"type":"array","minItems":1,"maxItems":1,"items":{"properties":{"message":{"type":"string"}}}}}},"Account":{"properties":{"balance":{"description":"The balance in the account's default currency","type":"object","title":"Amount","required":["value","currency"],"properties":{"value":{"description":"Balance's value using the number of decimal places defined by ISO 4217","externalDocs":{"description":"Decimal places table","url":"https://www.currency-iso.org/en/home/tables/table-a1.html"},"type":"number","x-implementation":{"description":"The real time balance (not the daily one!)","source":{"system":"Core Banking","data":"ZBAL0.RTBAL"}}},"currency":{"description":"An ISO 4217 code","externalDocs":{"url":"https://www.iso.org/iso-4217-currency-codes.html"},"type":"string","example":"USD","x-implementation":{"source":{"system":"Core Banking","data":"ZBAL0.RTCUR"}}}}}}}}}}</code></pre>
  </div>
</div>

<h1 id="replacing-elements">Replacing elements</h1>

<p>It‚Äôs fairly common to tweak OpenAPI files, especially before putting them in an API portal. You may have to replace some server URLs, update version number and replace some descriptions. That can be easily done with JQ. To learn how to replace values, we‚Äôll work on the info section of <code>demo-api-openapi.json</code> with <code>=</code> and <code>|=</code> operators . And we will also see how to save the modified file because it wouldn‚Äôt make any sense to not be able to save our modifications.</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Operators</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>.info.description = "New description."</code><br /><code>.info.description = .info.contact.name</code></td>
      <td>Replaces a value, the input to the right-hand-side (rhs) is the same as the input to the left-hand-side (lhs) rather than the value at the lhs path</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Plainassignment:=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>.info.contact |= .name</code><br /><code>.info.version |= sub("-snapshot";"")</code></td>
      <td>Replaces a value, it takes a filter on the right-hand side and works out the new value for the property of `.` being assigned to by running the old value through this expression</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Update-assignment:|=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<p>This section‚Äôs content is also available as an asciinema bash session:</p>

<div class="card card-code card-bash text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Replacing elements</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="bash session player controls">
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body bash-player">
    <asciinema-player id="player" title="Replacing elements" author="Arnaud Lauret" rows="24" cols="125" src="/code/api-toolbox-jq-and-openapi/part-3/replace.cast"></asciinema-player>
  </div>
</div>

<h2 id="replacing-a-value-with-">Replacing a value with =</h2>

<p>The following command line shows how to print the <code>.info.description</code> property of <code>demo-api-openapi.json</code> file (as we have learned to do so in part 1 of this post series):</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.description&#39; demo-api-openapi.json

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Printing .info.description original value</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io] $jq &#39;.info.description&#39; demo-api-openapi.json 
&quot;The Banking API provides access to the [Banking Company](http://www.bankingcompany.com) services, which include bank account information, beneficiaries, and money transfer management.&lt;!--more--&gt;\n\n# Authentication\n\n## How to \n- Register\n- Create an APP\n- Request credentials\n\n# Use cases\n\n## Transferring money to an account or preexisting beneficiary\n\nThe _transfer money_ operation allows one to transfer an `amount` of money from a `source` account to a `destination` account or beneficiary.\nIn order to use an appropriate `source` and `destination`, we recommend to use _list sources_ and _list source&#39;s destinations_ as shown in the figure below (instead of using _list accounts_ and _list beneficiaries_).\n\n![Diagram](http://localhost:9090/12.2-operation-manual-diagram.svg)\n\n## Cancelling a delayed or recurring money transfer\n\n- List money transfers: To list existing money transfers and select the one to delete\n- Cancel a money transfer: To cancel the selected money transfer\n&quot;</code></pre>
  </div>
</div>

<p>The next listing shows how modifying this value is as simple, thanks to <code>=</code> operator. By adding <code>="New description"</code> after the property‚Äôs path, its content is modified like in any programming language. And now instead of returning the <code>.info.description</code> value, jq returns the whole document in which this property‚Äôs value has been replaced by ‚ÄúNew description‚Äù.</p>

<p>The listing shows also 2 different ways to only show what we need to see. The first one is to use head (which show only the nth first line) and the second one consists in piping the result of jq in another jq command to show only the value of <code>.info.description</code>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json
jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json | head -n6
jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json | jq &#39;.info.description&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Modifying .info.description</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io] $jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json
{
...full modified document ...
}
[apihandyman.io] $jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json | head -n6 
{
  &quot;openapi&quot;: &quot;3.0.0&quot;,
  &quot;info&quot;: {
    &quot;title&quot;: &quot;Banking API&quot;,
    &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
    &quot;description&quot;: &quot;New description&quot;,
[apihandyman.io] $jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json | jq &#39;.info.description&#39;
&quot;New description&quot;</code></pre>
  </div>
</div>

<p>Anything can be put on the right side of the <code>=</code> operator as shown in the following listing. The command line allows to replace the value of <code>.info.contact</code> by another JSON object.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.contact&#39; demo-api-openapi.json
jq &#39;.info.contact = { name: &quot;The Awesome Banking API Team&quot;, url: &quot;www.bankingcompany.com&quot; }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Modifying an entire object value</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io] $jq &#39;.info.contact&#39; demo-api-openapi.json
{
  &quot;name&quot;: &quot;The Banking API team&quot;,
  &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
  &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
}
[apihandyman.io] $jq &#39;.info.contact = { name: &quot;The Awesome Banking API Team&quot;, url: &quot;www.bankingcompany.com&quot; }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;
{
  &quot;name&quot;: &quot;The Awesome Banking API Team&quot;,
  &quot;url&quot;: &quot;www.bankingcompany.com&quot;
}</code></pre>
  </div>
</div>

<h2 id="saving-a-copy-of-modified-file">Saving (a copy of) modified file</h2>

<p>But those command lines did not actually saved the modified files; indeed the modified content is just printed in the terminal. Unfortunately jq does not come with in-place modification like <code>sed</code>. But that‚Äôs not really a problem, we can use a good old <code>&gt;</code> to save result in another file as shown below (and once really sure of what we have done, we can replace the original one).</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json &gt; demo-api-openapi-mod.json
jq &#39;.info.description&#39; demo-api-openapi-mod.json

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Saving modified file</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io] $jq &#39;.info.description=&quot;New description&quot;&#39; demo-api-openapi.json &gt; demo-api-openapi-mod.json 
[apihandyman.io] $jq &#39;.info.description&#39; demo-api-openapi-mod.json
&quot;New description&quot;</code></pre>
  </div>
</div>

<h2 id="using-filters-when-replacing-a-value">Using filters when replacing a value</h2>

<p>When I said that anything can be put on the right side, it‚Äôs virtually anything; including complex filters chains like the one we have learned to create previously in part 1 and 2. Let‚Äôs see that with a very simple example. The following listing shows how to delete the ‚Äú-snapshot‚Äù suffix from the <code>.info.version</code> property using the <code>sub</code> filter (which replaces a string by another one inside a string) on the <code>.info.version</code> property.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.version&#39; demo-api-openapi.json 
jq &#39;.info.version = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json
jq &#39;.info.version = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info.version&#39; 

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Using filters</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.version&#39; demo-api-openapi.json
&quot;1.0.0-snapshot&quot;
[apihandyman.io]$ jq &#39;.info.version = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json
{
  ...full modified document
}
[apihandyman.io]$ jq &#39;.info.version = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info.version&#39;
&quot;1.0.0&quot;</code></pre>
  </div>
</div>

<p>Did you noticed the parenthesis around the right side of the <code>=</code> operator? They are very important. If you forget them, be ready to face more or less unexpected consequences depending on what you do. Here it hopefully break swith an error without silently doing nasty stuff. Indeed, here, without <code>()</code>, the result of <code>.info.version = .info.version</code>, which is the whole document (a JSON object), is piped into the <code>sub</code> filter which expects a string. So always put parenthesis around the right side if there are some piped filters.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.version = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json
jq &#39;.info.version = .info.version | sub(&quot;-snapshot&quot;;&quot;&quot;)&#39;  demo-api-openapi.json

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Do not forget parenthesis</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.version = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info.version&#39;
&quot;1.0.0&quot;
[apihandyman.io]$ jq &#39;.info.version = .info.version | sub(&quot;-snapshot&quot;;&quot;&quot;)&#39;  demo-api-openapi.json
jq: error (at demo-api-openapi.json:0): object ({&quot;openapi&quot;:...) cannot be matched, as it is not a string</code></pre>
  </div>
</div>

<p>And again, when I said that anything could be put on the right side, it‚Äôs really anything. Even anything from from anywhere. For example, the following command line put the modified version number into the description.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.description&#39; demo-api-openapi.json
jq &#39;.info.description = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info.description&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Using anything from anywhere</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.description&#39; demo-api-openapi.json
&quot;The Banking API provides access to the [Banking Company](http://www.bankingcompany.com) services, which include bank account information, beneficiaries, and money transfer management.&lt;!--more--&gt;\n\n# Authentication\n\n## How to \n- Register\n- Create an APP\n- Request credentials\n\n# Use cases\n\n## Transferring money to an account or preexisting beneficiary\n\nThe _transfer money_ operation allows one to transfer an `amount` of money from a `source` account to a `destination` account or beneficiary.\nIn order to use an appropriate `source` and `destination`, we recommend to use _list sources_ and _list source&#39;s destinations_ as shown in the figure below (instead of using _list accounts_ and _list beneficiaries_).\n\n![Diagram](http://localhost:9090/12.2-operation-manual-diagram.svg)\n\n## Cancelling a delayed or recurring money transfer\n\n- List money transfers: To list existing money transfers and select the one to delete\n- Cancel a money transfer: To cancel the selected money transfer\n&quot;
[apihandyman.io]$ jq &#39;.info.description = (.info.version | sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info.description&#39;
&quot;1.0.0&quot;</code></pre>
  </div>
</div>

<h2 id="replacing-a-value-with--1">Replacing a value with |=</h2>

<p>deleting ‚Äú-snapshot‚Äù from the version number can be done in a more elegant way using the <code>|=</code> operator, as shown in the following listing. Thanks to this operator, when using <code>.</code> on the right side, you only get what was passed on the left side and so you may not need to use <code>|</code> (reminder <code>. | some_filter</code> is equivalent to <code>some_filter</code>).</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.version&#39; demo-api-openapi.json 
jq &#39;.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;)&#39; demo-api-openapi.json
jq &#39;.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;)&#39; demo-api-openapi.json | jq &#39;.info.version&#39; 

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Using |= instead of =</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.version&#39; demo-api-openapi.json
&quot;1.0.0-snapshot&quot;
[apihandyman.io]$ jq &#39;.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;)&#39; demo-api-openapi.json
{
  ...full modified document
}
[apihandyman.io]$ jq &#39;.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;)&#39; demo-api-openapi.json | jq &#39;.info.version&#39;
&quot;1.0.0&quot;</code></pre>
  </div>
</div>

<p>That works with objects, let‚Äôs invert email and url values in the contact object. As you can see, url value is accessed with <code>.url</code> as only the contact object value is available on the right side (same for email); if we had used <code>=</code> we should have used <code>.info.contact.url</code>. Note also how name is kept unmodified by just using <code>name</code>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.contact&#39; demo-api-openapi.json 
jq &#39;.info.contact |= { name, url: .email, email: .url }&#39; demo-api-openapi.json
jq &#39;.info.contact |= { name, url: .email, email: .url }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">|= operator works on object too</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.contact&#39; demo-api-openapi.json
{
  &quot;name&quot;: &quot;The Banking API team&quot;,
  &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
  &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
}
[apihandyman.io]$ jq &#39;.info.contact |= { name, url: .email, email: .url }&#39; demo-api-openapi.json
{
  ...full modified document
}
[apihandyman.io]$ jq &#39;.info.contact |= { name, url: .email, email: .url }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;
&quot;1.0.0&quot;</code></pre>
  </div>
</div>

<h2 id="chaining-modifications">Chaining modifications</h2>

<p>Obviously, jq allows to do more than one modification at a time. You probably already guessed how to do so, you just need to pipe all modifications one after another as shown below on line 12 and 16. Here, we replace <code>.info.description</code> value by ‚ÄúNew description.‚Äù using <code>=</code> and then <code>|</code> the result to another modification consisting in deleting ‚Äú-snapshot‚Äù from <code>.info.version</code> using <code>|=</code> and <code>sub</code>. The final result shows both modifications.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info&#39; demo-api-openapi.json
jq &#39;(.info.description = &quot;New description.&quot;) | (.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json
jq &#39;(.info.description = &quot;New description.&quot;) | (.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title"></p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-collapsed"><code class="code-block">[apihandyman.io]$ jq &#39;.info&#39; demo-api-openapi.json
{
  &quot;title&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
  &quot;description&quot;: &quot;The Banking API provides access to the [Banking Company](http://www.bankingcompany.com) services, which include bank account information, beneficiaries, and money transfer management.&lt;!--more--&gt;\n\n# Authentication\n\n## How to \n- Register\n- Create an APP\n- Request credentials\n\n# Use cases\n\n## Transferring money to an account or preexisting beneficiary\n\nThe _transfer money_ operation allows one to transfer an `amount` of money from a `source` account to a `destination` account or beneficiary.\nIn order to use an appropriate `source` and `destination`, we recommend to use _list sources_ and _list source&#39;s destinations_ as shown in the figure below (instead of using _list accounts_ and _list beneficiaries_).\n\n![Diagram](http://localhost:9090/12.2-operation-manual-diagram.svg)\n\n## Cancelling a delayed or recurring money transfer\n\n- List money transfers: To list existing money transfers and select the one to delete\n- Cancel a money transfer: To cancel the selected money transfer\n&quot;,
  &quot;contact&quot;: {
    &quot;name&quot;: &quot;The Banking API team&quot;,
    &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
    &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
  }
}
[apihandyman.io]$ jq &#39;(.info.description = &quot;New description.&quot;) | (.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json
{
  ...full modified document...
}
[apihandyman.io]$ jq &#39;(.info.description = &quot;New description.&quot;) | (.info.version |= sub(&quot;-snapshot&quot;;&quot;&quot;))&#39; demo-api-openapi.json | jq &#39;.info&#39;
{
  &quot;title&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;New description.&quot;,
  &quot;contact&quot;: {
    &quot;name&quot;: &quot;The Banking API team&quot;,
    &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
    &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
  }
}</code></pre>
  </div>
</div>

<h2 id="jq-module">JQ module</h2>

<p>Here‚Äôs a JQ module demonstrating the various use of <code>=</code> and <code>|=</code> we have seen (use <code>jq -r replace.jq demo-api-openapi.json</code> to see it in action).</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">replace.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/replace.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-collapsed code-copy"><code class="code-block"># Basic value replacement using =
(.info.description = "New description.") | # modified document
                                           # goes to next step
# Using processing when setting value
(.info.version = (.info.version | sub("-snapshot";"-no-snapshot"))) |
# Any type of value can be provided on right side of =
(
  .info.contact = { 
                    name: "The Awesome Banking API Team", 
                    email: "www.bankingcompany.com"
                  }
) |
# |= can also be used to only work on what is provided on left side
(.info.version |= sub("-no-snapshot";"")) |
# It works on objects too
(
  .info.contact |= { 
                    name, # unmodified 
                    url: .email, # path of value inside .info.contact
                    email: "api@bankingcompany.com"
                  }
)</code></pre>
  </div>
</div>

<h1 id="adding-elements">Adding elements</h1>

<p>JQ does not only allow to replace existing values, it allows also to add elements thanks to the <code>+=</code> operator which can be used on many kind of value and <code>|=</code> which can be used on objects.</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Operators</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>.info.description += "More description"</code><br /><code>.info.description += .info.contact.name</code></td>
      <td>Increments a number value, concatenates string or add properties to object</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Arithmeticupdate-assignment:+=,-=,*=,/=,%=,//=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code></code></td>
      <td></td>
      <td><a class="btn-documentation" href="" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<p>This section‚Äôs content is also available as an asciinema bash session:</p>

<div class="card card-code card-bash text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Adding elements</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="bash session player controls">
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body bash-player">
    <asciinema-player id="player" title="Adding elements" author="Arnaud Lauret" rows="24" cols="125" src="/code/api-toolbox-jq-and-openapi/part-3/add.cast"></asciinema-player>
  </div>
</div>

<h2 id="appending-to-a-string-with-">Appending to a string with +=</h2>

<p>The <code>+=</code> operator is used in various programming language; <code>a+=x</code> usually means <code>a=a+x</code> and jq is no exception. But if such operator is usually to be used with numbers, jq allows to use it with other types such as string as shown in the listing below. As comparison, line 3 and 5 shows how to add the ‚Äú is awesome‚Äù string to <code>.info.contact.name</code> using <code>=</code> and <code>|=</code>. And line 5 shows how to do the same modification using <code>+=</code>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.contact.name&#39; demo-api-openapi.json 
jq &#39;.info.contact.name = .info.contact.name + &quot; is awesome&quot;&#39; demo-api-openapi.json | jq &#39;.info.contact.name&#39;
jq &#39;.info.contact.name |= . + &quot; is awesome&quot;&#39; demo-api-openapi.json | jq &#39;.info.contact.name&#39;
jq &#39;.info.contact.name += &quot; is awesome&quot;&#39; demo-api-openapi.json | jq &#39;.info.contact.name&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Appending to a string</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.contact.name&#39; demo-api-openapi.json 
&quot;The Banking API team&quot;
[apihandyman.io]$ jq &#39;.info.contact.name = .info.contact.name + &quot; is awesome&quot;&#39; demo-api-openapi.json | jq &#39;.info.contact.name&#39;
&quot;The Banking API team is awesome&quot;
[apihandyman.io]$ jq &#39;.info.contact.name |= . + &quot; is awesome&quot;&#39; demo-api-openapi.json | jq &#39;.info.contact.name&#39;
&quot;The Banking API team is awesome&quot;
[apihandyman.io]$ jq &#39;.info.contact.name += &quot; is awesome&quot;&#39; demo-api-openapi.json | jq &#39;.info.contact.name&#39;
&quot;The Banking API team is awesome&quot;</code></pre>
  </div>
</div>

<h2 id="adding-properties-to-object-with-">Adding properties to object with +=</h2>

<p>More interesting, <code>+=</code> can be used on objects; that means it can be used to add properties to existing objects. The following listing shows how a Slack channel name can be added to <code>.info.contact</code>. All that is needed is to put an object with the desired properties on the right side of <code>+=</code>.</p>

<p>Note that this new property name is prefixed with <code>x-</code>; indeed the standard OpenAPI Contact object does not have such property but the OpenAPI specification allows to add custom ones. They must be prefixed by <code>x-</code> so parsers can detect them and do not consider them as errors. Note also that as this name contains a <code>-</code> is must b quoted.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.contact&#39; demo-api-openapi.json
jq &#39;.info.contact += {&quot;x-slack&quot;: &quot;apiteam&quot; }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;
</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Adding properties</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.contact&#39; demo-api-openapi.json
{
  &quot;name&quot;: &quot;The Banking API team&quot;,
  &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
  &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
}
[apihandyman.io]$ jq &#39;.info.contact += {&quot;x-slack&quot;: &quot;api-team&quot; }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;
{
  &quot;name&quot;: &quot;The Banking API team&quot;,
  &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
  &quot;url&quot;: &quot;developer.bankingcompany.com&quot;,
  &quot;x-slack&quot;: &quot;apiteam&quot;
}</code></pre>
  </div>
</div>

<h2 id="adding-and-updating-properties-with-">Adding and updating properties with +=</h2>

<p>Another interesting aspect of <code>+=</code> is that it can be used to replace values inside an object as shown below. The jq command on line 7 still adds a <code>x-slack</code> property to <code>.info.contact</code> but it also updates the existing name to ‚ÄúThe Awesome Banking API team‚Äù.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info.contact&#39; demo-api-openapi.json
jq &#39;.info.contact += { name: &quot;The Awesome Banking API team&quot;, &quot;x-slack&quot;: &quot;apiteam&quot; }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Adding and updating properties</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info.contact&#39; demo-api-openapi.json
{
  &quot;name&quot;: &quot;The Banking API team&quot;,
  &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
  &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
}
[apihandyman.io]$ jq &#39;.info.contact += { name: &quot;updated name&quot;, &quot;x-slack&quot;: &quot;apiteam&quot; }&#39; demo-api-openapi.json | jq &#39;.info.contact&#39;
{
  &quot;name&quot;: &quot;The Awesome Banking API team&quot;,
  &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
  &quot;url&quot;: &quot;developer.bankingcompany.com&quot;,
  &quot;x-slack&quot;: &quot;apiteam&quot;
}</code></pre>
  </div>
</div>

<h2 id="jq-module-1">JQ module</h2>

<p>Before going further and to add real stuff on an OpenAPI file, here‚Äôs a jq module summarizing what we have learned about <code>+=</code>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">add.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/add.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-copy"><code class="code-block"># += adds anything to an existing value
# String concatenation
# Equivalent to 
#   .info.contact.name = .info.contact.name + " is awesome"
#   .info.contact.name |= . + " is awesome"
(.info.contact.name += " is awesome") | # Equivalent to .info.contact.name = .info.contact.name + " is awesome"
# Adding a property
(.info.contact += {"x-slack": "api-team" }) |
# Adding a property and updating existing name
(.info.contact += {"x-fax": "555-06-777", name: "The Awesome Banking API team"})

</code></pre>
  </div>
</div>

<h2 id="adding-missing-500-response-when-needed-with-">Adding missing 500 response when needed with +=</h2>

<p>So far, we have replaced/add to known elements (<code>.info.version</code>) inside the demo OpenAPI file. Whatever the operator used (<code>=</code>, <code>|=</code> or <code>+=</code>,), we only provided them a static reference to update. But jq is more clever than that, we already have seen that we can but anything on the right side of an operator, it‚Äôs the same on the left side.</p>

<p>Let‚Äôs say we have an OpenAPI file in which some operations lack the definition of 500 (unexpected server error) responses. We could use <code>+=</code> on their responses list to add the missing 500 response.</p>

<div class="text-center">
      <figure class="figure">
        
        <img src="/images/api-toolbox-jq-and-openapi-part-3-modifying-openapi-files-with-jq/jq-openapi-http-status-codes.png" class="figure-img img-fluid" />
        
        
      </figure>
    </div>

<p>The path to each operations responses list is <code>.paths.&lt;some path&gt;.&lt;some http method&gt;.responses</code>, unfortunately, path and http method will never be the same and some operations may have a 500 response defined. We could manually and painfully list all the response without 500 and then write a jq file to update them all‚Ä¶ Hopefully we won‚Äôt. We can let jq search and update the responses lists when needed.</p>

<p>First we need to identify the operation missing a 500 reponse. This is done with the following jq filters.</p>

<div class="card card-code text-white bg-dark border-dark">
  
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Selecting responses list without 500</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-copy"><code class="code-block">.paths[][] |
select(type == &quot;object&quot;) |
select(has(&quot;responses&quot;)) | 
.responses |
select(has(&quot;500&quot;) | not)</code></pre>
  </div>
</div>

<p>Note that we cannot simply use <code>paths[][].responses</code> because of path parameters list and some x-tension not containing a responses property, hence the two <code>select</code>. Without <code>select(type == "object")</code>, we have have a <em>Cannot index array with string ‚Äúresponses‚Äù</em> error because the path parameters list. And without <code>select(has("responses"))</code>we would have some <code>null</code> elements in out final list.</p>

<p>Once we get, at last, to the responses we keep only the one not having already a 500 property using <code>select</code>, <code>has</code> and <code>not</code>.</p>

<p>The following listing shows the result of this filters combination:</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.paths[][] | select(type==&quot;object&quot;) | select(has(&quot;responses&quot;)) | .responses | select(has(&quot;500&quot;) | not) &#39; demo-api-openapi.json

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Selecting responses list without 500 command line</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.paths[][] | select(type==&quot;object&quot;) | select(has(&quot;responses&quot;)) | .responses | select(has(&quot;500&quot;) | not) &#39; demo-api-openapi.json 
...
{
  &quot;200&quot;: {
    &quot;description&quot;: &quot;The money transfer has been update&quot;
  }
}
{
  &quot;204&quot;: {
    &quot;description&quot;: &quot;The money transfer has been deleted&quot;
  },
  &quot;404&quot;: {
    &quot;description&quot;: &quot;The money transfer does not exist&quot;
  }
}</code></pre>
  </div>
</div>

<p>Now that we are able to list the elements to fix, let‚Äôs put these filters on the left side of <code>+=</code> and put the missing data on the right as we have just learned :</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">add-missing-500.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/add-missing-500.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-collapsed code-copy"><code class="code-block"># First we select the elements to modify
(
  .paths[][] |
  select(type == "object") |
  select(has("responses")) | 
  .responses |
  select(has("500") | not)
)
# Then each of them is modified 
+= {
  "500":{
    description: "Unexpected error",
    content: {
      "application/json": {
        schema: {
          "$ref": "#components/schemas/ProviderError"
        }
      }
    }
  }
}
# The fully modified document is returned</code></pre>
  </div>
</div>

<p>As shown in the two following listings, the get /accounts operation does not have a 500 but it is hopefully easily fixed by applying <code>add-missing-500.jq</code> on the file. Note that all other operations lacking a 500 are also fixed as the new 500 property is added to each element identified by the filters on the left side of <code>+=</code>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.paths[&quot;/accounts&quot;].get.responses&#39; demo-api-openapi.json 

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Before</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers code-collapsed"><code class="code-block">[apihandyman.io]$ jq &#39;.paths[&quot;/accounts&quot;].get.responses&#39; demo-api-openapi.json 
{
  &quot;200&quot;: {
    &quot;description&quot;: &quot;User&#39;s accounts&quot;,
    &quot;content&quot;: {
      &quot;application/json&quot;: {
        &quot;schema&quot;: {
          &quot;required&quot;: [
            &quot;properties&quot;
          ],
          &quot;properties&quot;: {
            &quot;items&quot;: {
              &quot;type&quot;: &quot;array&quot;,
              &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/components/schemas/Account&quot;
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
  </div>
</div>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq -f add-missing-500.jq demo-api-openapi.json | jq &#39;.paths[&quot;/accounts&quot;].get.responses&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">After</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers code-collapsed"><code class="code-block">[apihandyman.io]$ jq -f add-missing-500.jq demo-api-openapi.json | jq &#39;.paths[&quot;/accounts&quot;].get.responses&#39;
{
  &quot;200&quot;: {
    &quot;description&quot;: &quot;User&#39;s accounts&quot;,
    &quot;content&quot;: {
      &quot;application/json&quot;: {
        &quot;schema&quot;: {
          &quot;required&quot;: [
            &quot;properties&quot;
          ],
          &quot;properties&quot;: {
            &quot;items&quot;: {
              &quot;type&quot;: &quot;array&quot;,
              &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/components/schemas/Account&quot;
              }
            }
          }
        }
      }
    }
  },
  &quot;500&quot;: {
    &quot;description&quot;: &quot;Unexpected error&quot;,
    &quot;content&quot;: {
      &quot;application/json&quot;: {
        &quot;schema&quot;: {
          &quot;$ref&quot;: &quot;#components/schemas/ProviderError&quot;
        }
      }
    }
  }
}</code></pre>
  </div>
</div>

<h2 id="adding-missing-response-content-when-needed-with--and-complex-update-filter">Adding missing response content when needed with |= and complex update filter</h2>

<p>In the <code>demo-api-openapi.json</code> file some operations may have basic <code>401</code> and <code>403</code> responses but without any schema (missing <code>content</code> property). Let‚Äôs fix that with a jq module inpired by previous one but using <code>|=</code> with a more complex filters on the left and accepting a regex HTTP status code and a schema model name.</p>

<div class="text-center">
      <figure class="figure">
        
        <img src="/images/api-toolbox-jq-and-openapi-part-3-modifying-openapi-files-with-jq/jq-openapi-response-content.png" class="figure-img img-fluid" />
        
        
      </figure>
    </div>

<p>The following jq module is composed of a <code>|=</code> main statement. On its left side, it selects all responses list. On its right side, it works on each key/value of all responses list using <code>with_entry</code>. If the key (HTTP status code) matches the regex (<code>$coderegex</code>) provided as a command line argument and does not already contain a <code>content</code> property, it add a <code>content</code> to the value. If not, it leaves the value as is is by returning <code>.</code>.</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">add-missing-response-content.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/add-missing-response-content.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-collapsed code-copy"><code class="code-block"># Selecting all responses list
( 
  .paths[][] |
  select(type == "object") |
  select(has("responses")) | 
  .responses
) 
|= # Updating selected values
  with_entries( # transforms key: value into { key: key, value: value}
  # $coderegex is provided with --arg coderegex 40.
  if (.key | test($coderegex)) and (.value | has("content") | not) then
    .value += { # Actually updating the value
      content: {
        "application/json": {
          schema: { # $schema is provided with --arg schema ConsumerError 
            "$ref": ("#/components/schemas/" + $schema)
          }
        }
      }
  }
  else
    . # unmodified element
  end
)</code></pre>
  </div>
</div>

<p>Here‚Äôs the responses list of post /beneficiaries before modification:</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.paths[&quot;/beneficiaries&quot;].post.responses&#39; demo-api-openapi.json 

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Before</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.paths[&quot;/beneficiaries&quot;].post.responses&#39; demo-api-openapi.json 
{
  &quot;201&quot;: {
    &quot;description&quot;: &quot;Beneficiary added&quot;
  },
  &quot;401&quot;: {
    &quot;description&quot;: &quot;Unauthorized&quot;
  },
  &quot;403&quot;: {
    &quot;description&quot;: &quot;Forbidden&quot;
  }
}</code></pre>
  </div>
</div>

<p>Once <code>add-missing-response-content.jq</code> is applied on the OpenAPI file, the responses matching the <code>40.</code> regex (<code>coderegex</code> command line argument) have been modified to add a content with application/json media type referencing the schema provided with <code>schema</code> command line argument. And as seen previously that has been done to all operations responses.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq --arg coderegex 40. --arg schema ConsumerError -f add-missing-response-content.jq demo-api-openapi.json | jq &#39;.paths[&quot;/beneficiaries&quot;].post.responses&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Before</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers code-collapsed"><code class="code-block">[apihandyman.io]$ jq --arg coderegex 40. --arg schema ConsumerError -f add-missing-response-content.jq demo-api-openapi.json | jq &#39;.paths[&quot;/beneficiaries&quot;].post.responses&#39;
{
  &quot;201&quot;: {
    &quot;description&quot;: &quot;Beneficiary added&quot;
  },
  &quot;401&quot;: {
    &quot;description&quot;: &quot;Unauthorized&quot;,
    &quot;content&quot;: {
      &quot;application/json&quot;: {
        &quot;schema&quot;: {
          &quot;$ref&quot;: &quot;#/components/schemas/ConsumerError&quot;
        }
      }
    }
  },
  &quot;403&quot;: {
    &quot;description&quot;: &quot;Forbidden&quot;,
    &quot;content&quot;: {
      &quot;application/json&quot;: {
        &quot;schema&quot;: {
          &quot;$ref&quot;: &quot;#/components/schemas/ConsumerError&quot;
        }
      }
    }
  }
}</code></pre>
  </div>
</div>

<p>Note that the selection of elements to modify with <code>$coderegex</code> could be fully made on right side (you could try to modify the module to do so).</p>

<h1 id="deleting-elements">Deleting elements</h1>

<p>Last but not least, deleting elements. We‚Äôll learn to use the following jq operators and function:</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Operators and Functions</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>.info.description = "New description."</code><br /><code>.info.description = .info.contact.name</code></td>
      <td>Replaces a value, the input to the right-hand-side (rhs) is the same as the input to the left-hand-side (lhs) rather than the value at the lhs path</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Plainassignment:=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>.info.contact |= .name</code><br /><code>.info.version |= sub("-snapshot";"")</code></td>
      <td>Replaces a value, it takes a filter on the right-hand side and works out the new value for the property of `.` being assigned to by running the old value through this expression</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Update-assignment:|=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>.info.contact |= del(.contact)</code><br /><code>del(.info.contact)</code></td>
      <td>Removes a key and its corresponding value from an object</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#del(path_expression)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>walk(f)</code></td>
      <td>Applies a filter recursively to every component of the input entity</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#walk(f)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>delpaths(PATHS)</code></td>
      <td>Deletes an array of paths. each path is an array of string and numbers.</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#delpaths(PATHS)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<p>This section‚Äôs content is also available as an asciinema bash session:</p>

<div class="card card-code card-bash text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Deleting elements</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="bash session player controls">
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body bash-player">
    <asciinema-player id="player" title="Deleting elements" author="Arnaud Lauret" rows="24" cols="125" src="/code/api-toolbox-jq-and-openapi/part-3/delete.cast"></asciinema-player>
  </div>
</div>

<h2 id="dumbly-deleting-contact-with--or-">Dumbly deleting contact with = or |=</h2>

<p>If we want to get rid of the contact property in info, we can do a replacement using <code>=</code> or a more clever <code>|=</code> as we have seen before. The idea is to keep all other properties (<code>title</code>, <code>version</code>, and <code>description</code>). Note how the <code>|=</code> syntax is simpler.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info&#39; demo-api-openapi.json
jq &#39;.info = { info: .info.title, version: .info.version, description: .info.description }&#39; demo-api-openapi.json | jq &#39;.info&#39;
jq &#39;.info |= { title, version, description }&#39; demo-api-openapi.json | jq &#39;.info&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Keeping title, version and description to delete contact</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers code-collapsed"><code class="code-block">[apihandyman.io]$ jq &#39;.info&#39; demo-api-openapi.json
{
  &quot;title&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
  &quot;description&quot;: &quot;The Banking API provides access ...&quot;,
  &quot;contact&quot;: {
    &quot;name&quot;: &quot;The Banking API team&quot;,
    &quot;email&quot;: &quot;api@bankingcompany.com&quot;,
    &quot;url&quot;: &quot;developer.bankingcompany.com&quot;
  }
}
[apihandyman.io]$ jq &#39;.info = { info: .info.title, version: .info.version, description: .info.description }&#39; demo-api-openapi.json | jq &#39;.info&#39;
{
  &quot;info&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
  &quot;description&quot;: &quot;The Banking API provides access ...&quot;
}
[apihandyman.io]$ jq &#39;.info |= { title, version, description }&#39; demo-api-openapi.json | jq &#39;.info&#39;
{
  &quot;info&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
  &quot;description&quot;: &quot;The Banking API provides access ...&quot;
}</code></pre>
  </div>
</div>

<h2 id="efficiently-deleting-contact-with-del">Efficiently deleting contact with del</h2>

<p>That works because there‚Äôs not too many properties to keep inside info. But if you work on a more complex object this could become quite boring to delete an element. Hopefully, there is a <code>del</code> function that can be used to actually delete an element. It can be used with <code>|=</code> but also alone. The <code>del</code> function takes a path expressions so it can be directly used on <code>.info.contact</code> to delete this property.</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq &#39;.info |= del(.contact)&#39; demo-api-openapi.json | jq &#39;.info&#39;
jq &#39;del(.info.contact)&#39; demo-api-openapi.json | jq &#39;.info&#39;

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Actually deleting contact</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ jq &#39;.info |= del(.contact)&#39; demo-api-openapi.json | jq &#39;.info&#39;
{
  &quot;title&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
  &quot;description&quot;: &quot;The Banking API provides access ...&quot;
}
[apihandyman.io]$ jq &#39;del(.info.contact)&#39; demo-api-openapi.json | jq &#39;.info&#39;
{
  &quot;title&quot;: &quot;Banking API&quot;,
  &quot;version&quot;: &quot;1.0.0-snapshot&quot;,
  &quot;description&quot;: &quot;The Banking API provides access ...&quot;
}</code></pre>
  </div>
</div>

<h2 id="deleting-deprecated-operations-or-properties-with-walk-and-del">deleting deprecated operations or properties with walk and del</h2>

<p>The OpenAPI 3 specification allows to tell that some operations ans even properties are deprecated by adding a <code>deprecated: true</code>. It can be useful to be able to delete all those deprecated elements.
That can be done quite easily with <code>walk</code> and <code>del</code> functions.</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Functions</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>.info.contact |= del(.contact)</code><br /><code>del(.info.contact)</code></td>
      <td>Removes a key and its corresponding value from an object</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#del(path_expression)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>walk(f)</code></td>
      <td>Applies a filter recursively to every component of the input entity</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#walk(f)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<p>The <code>walk</code> function is very useful, it will basically walk through all nodes inside the provided document and apply the filters provided as parameter. The following jq module is split in 3 steps and uses <code>walk</code> on each of them:</p>

<ul>
  <li>First we delete all object values having a deprecated property set to true</li>
  <li>Then we delete the keys having a null value created by first step</li>
  <li>And eventually, we delete all keys whose value became an empty object because of second step</li>
</ul>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">delete-deprecated.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/delete-deprecated.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          <a role="button" class="btn btn-secondary border-0 rounded-0 code-expandcollapse-btn" aria-label="expand or shrink" onclick="expandCollapseCode(this)" data-toggle="tooltip" data-placement="top" title="Expand/Shrink"><img class="btn-icon" src="/images/commons/icons/maximize.svg" /></a>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-collapsed code-copy"><code class="code-block"># Removes all object having a deprecated property set to true

# Before: "objectProperty": { "deprecated": true }
# After: "objectProperty": null
walk(
  if type=="object" and .deprecated == true then 
    del(.) 
  else 
    . 
  end
) | 
# Removes all property set to null ("nullProperty": null) created 
# when deleted objects containing deprecated set to true
walk(
  if type=="object" then 
    with_entries( 
      select( .value != null)
    ) 
  else  # Not an object, just keep it
    .
  end
) |
# Removes all empty property ("emptyProperty": {}) that may have
# been created when removing the null ones
walk(
  if type=="object" then 
    with_entries(
      select(.value != {} )
    )
  else # Not an object, just keep it
    . 
  end
)</code></pre>
  </div>
</div>

<p>Here‚Äôs the module in action (note for this demonstration we focus only on deprecated operations and reuse the  search operations module from part 2):</p>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq -r --arg deprecated true -f search-operations.jq demo-api-openapi.json
jq -f delete-deprecated.jq demo-api-openapi.json | jq -r -f search-operations.jq --arg deprecated true

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Deleting deprecated elements</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ jq -r --arg deprecated true -f search-operations.jq demo-api-openapi.json
[demo-api-openapi.jso]  delete  /beneficiaries/{id}     Delete a beneficiary (deprecated)
[demo-api-openapi.jso]  patch   /beneficiaries/{id}     Updates a beneficiary (deprecated)

[apihandyman.io]$ jq -f delete-deprecated.jq demo-api-openapi.json | jq -r -f search-operations.jq --arg deprecated true</code></pre>
  </div>
</div>

<h2 id="deleting-x-tensions-with-paths-and-delpaths">Deleting x-tensions with paths and delpaths</h2>

<p>Another simple way of deleting elements is to use <code>paths</code> and <code>delpaths</code>, we can use them to remove all x-tensions (custom properties starting whose names start with <code>x-</code>) from an OpenAPI file.</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Functions</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>paths</code></td>
      <td>Lists all possible paths in documents, each path is represented as an array</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#paths,paths(node_filter),leaf_paths" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>delpaths(PATHS)</code></td>
      <td>Deletes an array of paths. each path is an array of string and numbers.</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#delpaths(PATHS)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<p>First we list all paths to those x-tensions. The <code>paths</code> function returns an array of all paths to all elements inside a document. Each path is an array, for example the path to contact is <code>["info","contact"]</code> (hence <code>paths</code> returns an array of array). As we only want x-tensions, we filter this lists of paths to keep only the ones having their leafs prefixed by <code>x-</code>. Once we have this array of paths, we can use it as a parameter for delpaths and we‚Äôre done!</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">delete-xtensions.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/delete-xtensions.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-copy"><code class="code-block"># Lists all available x-tensions' paths
[(
  paths | # Lists ALL possible paths in documents 
          # (each path is represented as an array)
  select( # Keeps only the values for which what follows return true
    .[-1] | # Gets the path leaf (last item in array)
            # Equivalent to .[.|length-1]
    tostring | # Converts to string for next step
    test("^x-") # Matches "^x-" regex (starts with x-)
  )
)] as $xtensions |
# Delete all found x-tensions using their paths
delpaths($xtensions)</code></pre>
  </div>
</div>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq -r -f list-xtension-paths.jq demo-api-openapi.json
jq -f delete-xtensions.jq demo-api-openapi.json | jq -r -f list-xtension-paths.jq

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Deleting x-tensions</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ jq -r -f list-xtension-paths.jq demo-api-openapi.json 
[
  [
    &quot;paths&quot;,
    &quot;/accounts/{id}&quot;,
    &quot;get&quot;,
    &quot;x-implementation&quot;
  ],
  ...
]

[apihandyman.io]$ jq -f delete-xtensions.jq demo-api-openapi.json | jq -r -f list-xtension-paths.jq 
[]</code></pre>
  </div>
</div>

<h2 id="deleting-unsused-schemas-with-delpaths">Deleting unsused schemas with delpaths</h2>

<p>We‚Äôre under no obligation to use <code>paths</code> when using <code>delpaths</code>, we can build the paths ourselves.</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Filters and Functions</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>..</code></td>
      <td>Returns every value recursively</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#RecursiveDescent:.." target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>delpaths(PATHS)</code></td>
      <td>Deletes an array of paths. each path is an array of string and numbers.</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#delpaths(PATHS)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<p>The following module removes unused schemas from an OpenAPI file. Unused schemas are defined in <code>components.schemas</code> but never referenced in a <code>$ref</code> property.</p>

<p>To build the paths list, we first create a list of all possible $ref values using the keys of components.schemas. Then we substract all actually used $ref. Note the use of <code>..</code>to get all document‚Äôs nodes and <code>unique</code> to keep only one occurrence of each used $ref. Once we have a list of <code>#/components/schemas/name</code> strings, we transform them in paths by splitting on <code>/</code> and removing <code>#</code>. And eventually we use delpaths on the resulting array of paths. Note that delpaths accept a parameter which is not strictly an array of array, indeed the unsused schema paths list is only a succession of individual arrays not enclosed inside an array.</p>

<div class="card card-code text-white bg-dark border-dark">
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">delete-unused-schemas.jq</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code file controls">
          <a role="button" class="btn btn-secondary border-0 rounded-0" aria-label="download file" target="_blank" href="/code/api-toolbox-jq-and-openapi/part-3/delete-unused-schemas.jq" data-toggle="tooltip" data-placement="top" title="Download"><img class="btn-icon" src="/images/commons/icons/download.svg" /></a>
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-jq line-numbers code-copy"><code class="code-block">(
  # Defined schemas
  (
    .components.schemas | # select reusable schemas structure
    keys | # keeps only the schema names
    map("#/components/schemas/" + .) # return an array with schema refs
  )
  # Minus operator to substract used schemas from defined schemas
  -
  # Actually used schemas
  ([ # Creating an array
    .. | # selects all nodes
    select(type=="object") | # keeps only object
    select(has("$ref")) | # keeps only object having $ref property
    .["$ref"] # the $ref property (.$ref connot be used because of $) 
  ] | unique) # Keeps only one occurence
  |
  map(split("/") - ["#"])
) as $unused |
delpaths($unused)
</code></pre>
  </div>
</div>

<div class="card card-code text-white bg-dark border-dark">
  <pre class="copy-hidden code-copy">jq -r -f list-unused-schemas.jq demo-api-openapi.json
jq -f delete-unused-schemas.jq demo-api-openapi.json | jq -r -f list-unused-schemas.jq

</pre>
  <div class="card-header">
    <div class="row m-0">
      <div class="col align-self-center">
        <p class="m-0 title">Deleting unused schemas</p>
      </div>
      <div class="col col-auto pr-0">
        <div class="btn-group" role="group" aria-label="code snippet control">
          <a role="button" class="btn btn-secondary code-copy-btn border-0 rounded-0" aria-label="copy" data-toggle="tooltip" data-placement="top" title="Copy"><img class="btn-icon" src="/images/commons/icons/copy.svg" /></a>
          
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <pre class="language-bash line-numbers"><code class="code-block">[apihandyman.io]$ jq -r -f list-unused-schemas.jq demo-api-openapi.json 
[
  &quot;components&quot;,
  &quot;schemas&quot;,
  &quot;ProviderError&quot;
]
[
  &quot;components&quot;,
  &quot;schemas&quot;,
  &quot;UselessSchema&quot;
]

[apihandyman.io]$ jq -f delete-unused-schemas.jq demo-api-openapi.json | jq -r -f list-unused-schemas.jq</code></pre>
  </div>
</div>

<h1 id="summary">Summary</h1>

<p>And we‚Äôre done with part 3, you should now be able to modify any OpenAPI or any JSON file as you like using the following operators and functions:</p>

<table class="table-documentation-links">
  
  <thead>
    <tr>
      <th colspan="3" scope="col">JQ Filters, Operators and Functions</th>
    </tr>
  </thead>
  
  <tbody>



    <tr>
      <td><code>.info.description = "New description."</code><br /><code>.info.description = .info.contact.name</code></td>
      <td>Replaces a value, the input to the right-hand-side (rhs) is the same as the input to the left-hand-side (lhs) rather than the value at the lhs path</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Plainassignment:=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>.info.contact |= .name</code><br /><code>.info.version |= sub("-snapshot";"")</code></td>
      <td>Replaces a value, it takes a filter on the right-hand side and works out the new value for the property of `.` being assigned to by running the old value through this expression</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Update-assignment:|=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>.info.description += "More description"</code><br /><code>.info.description += .info.contact.name</code></td>
      <td>Increments a number value, concatenates string or add properties to object</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#Arithmeticupdate-assignment:+=,-=,*=,/=,%=,//=" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>.info.contact |= del(.contact)</code><br /><code>del(.info.contact)</code></td>
      <td>Removes a key and its corresponding value from an object</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#del(path_expression)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>walk(f)</code></td>
      <td>Applies a filter recursively to every component of the input entity</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#walk(f)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>paths</code></td>
      <td>Lists all possible paths in documents, each path is represented as an array</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#paths,paths(node_filter),leaf_paths" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>..</code></td>
      <td>Returns every value recursively</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#RecursiveDescent:.." target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>


    <tr>
      <td><code>delpaths(PATHS)</code></td>
      <td>Deletes an array of paths. each path is an array of string and numbers.</td>
      <td><a class="btn-documentation" href="https://stedolan.github.io/jq/manual/v1.6/#delpaths(PATHS)" target="jq" aria-label="open documentation in a new tab" data-toggle="tooltip" data-placement="right" title="Open documentation in a new tab"><svg height="100px" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M19.5,2.4c-2.8-1.8-6.6-1.9-9.5-0.3C7.1,0.5,3.3,0.6,0.5,2.4L0,2.7V19l1.5-1c2.4-1.5,5.6-1.5,7.9,0l0.5,0.3  l0.5-0.3c2.4-1.5,5.6-1.5,7.9,0l1.5,1V2.7L19.5,2.4z M2,15.5V3.9c2.2-1.2,4.8-1.1,7,0v11.7c-1.1-0.4-2.3-0.7-3.5-0.7  C4.3,14.9,3.1,15.1,2,15.5z M18,15.5c-2.2-0.9-4.8-0.9-7,0V3.9c2.2-1.2,4.9-1.2,7,0V15.5z"></path></svg></a></td>
    </tr>

  </tbody>
</table>

<h1 id="whats-next">What‚Äôs next</h1>

<p>With what you have learned in the first 3 parts, you should be able to achieve anything you want with jq. And known that we only scratched the surface, check jq‚Äôs documentation to discover all of its features. The next and final part is a little bonus in which you‚Äôll learn to colorize jq terminal output just for fun.</p>
:ET